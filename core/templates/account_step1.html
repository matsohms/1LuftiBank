<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Konto hinzufügen – Schritt 1</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; }
    .container { background: #eee; padding: 20px; margin: 40px auto; width: 90%; max-width: 600px; }
    .row { display: flex; gap: 10px; margin-bottom: 15px; }
    .row label { flex: 1; padding-top: 8px; }
    .row input, .row select { flex: 1; padding: 8px; background: #fff; border: 1px solid #ccc; }
    button { border: none; padding: 8px 16px; font-family: Arial; margin-right: 10px; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-secondary { background: #6c757d; color: #fff; }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const chkFree = document.getElementById('id_free_up_to');
      const costWithinRow = document.getElementById('row_cost_within');
      const freeAboveRow  = document.getElementById('row_free_above');
      const costAboveRow  = document.getElementById('row_cost_above');
      const modeSwitch   = document.getElementById('billing_mode');

      function toggleCostFields() {
        if (chkFree.checked) {
          costWithinRow.style.display = 'none';
        } else {
          costWithinRow.style.display = 'flex';
        }
      }
      chkFree.addEventListener('change', toggleCostFields);
      toggleCostFields();

      modeSwitch.addEventListener('change', () => {
        const isPercent = modeSwitch.value === 'percent';
        document.getElementById('label_cost_within').textContent = 
          isPercent ? 'Kosten pro Überweisung (%)' : 'Kosten pro Überweisung (LUF)';
        document.getElementById('cost_within_input').placeholder = 
          isPercent ? 'z.B. 0.5' : 'z.B. 2,50';
      });

      // Formatierung: Euro-Stil bei Blur
      document.querySelectorAll('input[data-currency]').forEach(inp => {
        inp.addEventListener('blur', () => {
          let v = parseFloat(inp.value.replace(',', '.'));
          if (!isNaN(v)) {
            inp.value = v.toLocaleString('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          }
        });
      });
    });
  </script>
</head>
<body>
  <div class="container">
    <h1>Konto hinzufügen – Schritt 1</h1>
    <form method="post">{% csrf_token %}
      <!-- Kontomodell -->
      <div class="row">
        <label for="id_account_model">Kontomodell</label>
        {{ form.account_model }}
      </div>

      <!-- Maximale Kontenauslastung -->
      <div class="row">
        <label for="id_max_balance">Maximale Kontoauslastung</label>
        {{ form.max_balance }}
      </div>

      <!-- Kostenlose Überweisung? -->
      <div class="row">
        <label for="id_free_up_to">Kostenlose Überweisung</label>
        <input type="checkbox" id="id_free_up_to" name="free_up_to" checked />
      </div>

      <!-- Kostenpflichtig bis -->
      <div class="row" id="row_cost_within">
        <label for="id_cost_within">Kostenpflichtig ab Betrag</label>
        {{ form.cost_within }}
      </div>

      <!-- Abrechnungsmodus -->
      <div class="row">
        <label for="billing_mode">Abrechnungsmodus</label>
        <select id="billing_mode" name="billing_mode">
          <option value="flat">Pauschal</option>
          <option value="percent">Prozent</option>
        </select>
      </div>

      <!-- Freies Volumen oberhalb -->
      <div class="row" id="row_free_above">
        <label for="id_free_above">Freies Volumen oberhalb</label>
        {{ form.free_above }}
      </div>

      <!-- Kosten oberhalb -->
      <div class="row" id="row_cost_above">
        <label for="id_cost_above">Kosten pro Überweisung</label>
        {{ form.cost_above }}
      </div>

      <button type="submit" class="btn-primary">Weiter</button>
      <a href="{% url 'customer_detail' customer.pk %}">
        <button type="button" class="btn-secondary">Abbrechen</button>
      </a>
    </form>
  </div>
</body>
</html>
